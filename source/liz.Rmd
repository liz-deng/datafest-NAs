---
title: "liz.rmd"
output:
  html_document: default
  pdf_document: default
date: "2023-04-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("tidyverse")
library("ggplot2")
library("usmap")
```

```{r wrangling}
pop <- read.csv("../../census_pop.csv") 


lawyers_per1k <- round((pop$lawyers_2021 / pop$pop_2021 * 1000), 2)
states <- state.name[match(pop$state, state.abb)]


lawyers <- data.frame(tolower(states), lawyers_per1k)
lawyers <- lawyers[-9,] %>%
  rename(state = tolower.states.)

lstate_shape <- map_data("state") %>%
  rename(state = region) %>%
  left_join(lawyers, by="state")

#View(lstate_shape)


all_q <- read.csv("../../questionpostsprocessed.csv") %>% 
  count(StateAbbr)


q_bystate <- all_q[-c(1:13, 46), ] %>%
  rename(num_q = n,
         state = StateAbbr)

merged <- merge(pop, q_bystate, by="state") 

join_qpop <- merged[, -c(2,3,5)] %>%
  mutate(q_per1k = round((num_q / pop_2021 * 1000), 2),
         lawyer_per1k = round((lawyers_2021 / pop_2021 * 1000), 2))

#join_qpop <- rename(join_qpop, abbr = state)

#View(join_qpop)
state <- state.name[match(join_qpop$abbr, state.abb)]

data <- mutate(join_qpop, state = tolower(state))
#View(data)

questions <- select(data, q_per1k, state)
#view(questions)



qstate_shape <- map_data("state") %>%
  rename(state = region) %>%
  left_join(questions, by="state")
  
#------Questions-------
  ggplot(qstate_shape) +
    geom_polygon(
      mapping = aes(x = long, y = lat, group = group, fill = q_per1k),
      color = "#011D2A",
      size = .08
    ) +
    coord_map() +
    scale_fill_continuous(low = "#E3F6FF", high = "#055377", na.value = "#A3A3A3") +
    labs(fill = "Questions per 1000 People", title="Rate of Questions Posted") +
     theme(
        axis.text.x=element_blank(), 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x=element_blank(), 
        axis.text.y=element_blank(),  
        axis.ticks.y=element_blank()  
        )

#------Lawyers-----------

lstate_shape <- map_data("state") %>%
  rename(state = region) %>%
  left_join(lawyers, by="state")

 ggplot(lstate_shape) +
    geom_polygon(
      mapping = aes(x = long, y = lat, group = group, fill = lawyers_per1k),
      color = "#62040A",
      size = .08
    ) +
    coord_map() +
    scale_fill_continuous(low = "white", high = "#D9000D", na.value = "#A3A3A3") +
    labs(fill = "Active Lawyers per 1000 People", title="Rate of Lawyers") +
     theme(
        axis.text.x=element_blank(), 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x=element_blank(), 
        axis.text.y=element_blank(),  
        axis.ticks.y=element_blank()  
        )

```
